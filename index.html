<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>åœ–ç‰‡å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f2f2f2;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    textarea {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #previewImg, #outputImg {
      max-width: 100%;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    #progressBar {
      width: 100%;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
      margin: 10px 0;
      display: none;
    }
    #progressBar div {
      height: 20px;
      width: 0;
      background: #007bff;
      transition: width 0.3s;
    }
    #log {
      background: #222;
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      height: 150px;
      overflow-y: auto;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 13px;
    }

    /* ğŸ”¹ å…¨éƒ¨æŒ‰éˆ• â†’ å¤§è—æŒ‰éˆ• */
    button,
    input[type="file"]::file-selector-button {
      display: block;
      background: #007bff;
      color: white;
      padding: 14px 24px;
      font-size: 18px;
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
      width: 100%;          /* æ‰‹æ©Ÿç‰ˆæ»¿ç‰ˆ */
      box-sizing: border-box;
      margin: 8px 0;
      border: none;
    }
    button:hover,
    input[type="file"]::file-selector-button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>åœ–ç‰‡å·¥å…·</h1>

    <!-- åœ–ç‰‡ â Base64 -->
    <div class="card">
      <h2>åœ–ç‰‡ â Base64</h2>
      <input type="file" id="imgToBase64" accept="image/*">
      <button id="convertToBase64">è½‰æ›</button>
      <textarea id="base64Output" rows="6" placeholder="é€™è£¡æœƒé¡¯ç¤º Base64"></textarea>
    </div>

    <!-- Base64 â åœ–ç‰‡ -->
    <div class="card">
      <h2>Base64 â åœ–ç‰‡</h2>
      <input type="file" id="base64File" accept=".txt">
      <button id="convertToImage">è½‰æ›ä¸¦é è¦½</button>
      <img id="outputImg" src="" alt="é è¦½åœ–ç‰‡">
    </div>

    <!-- åœ–ç‰‡å°ºå¯¸èª¿æ•´ -->
    <div class="card">
      <h2>åœ–ç‰‡å°ºå¯¸èª¿æ•´</h2>
      <input type="file" id="resizeFiles" accept="image/*" multiple>
      <select id="resizeOption">
        <option value="original">åŸå°ºå¯¸</option>
        <option value="512">512</option>
        <option value="1024">1024</option>
        <option value="1280">1280</option>
        <option value="custom">è‡ªè¨‚</option>
      </select>
      <input type="number" id="customWidth" placeholder="å¯¬åº¦(px)" style="display:none;">
      <input type="number" id="customHeight" placeholder="é«˜åº¦(px)" style="display:none;">
      <button id="startResize">é–‹å§‹è™•ç†</button>
      <div id="progressBar"><div></div></div>
      <button id="downloadZip" style="display:none;">ä¸‹è¼‰ ZIP</button>
      <div id="log"></div>
    </div>
  </div>

  <script>
    const logArea = document.getElementById("log");
    function log(msg) {
      logArea.innerHTML += msg + "<br>";
      logArea.scrollTop = logArea.scrollHeight;
    }

    // åœ–ç‰‡ â Base64
    document.getElementById("convertToBase64").addEventListener("click", () => {
      const file = document.getElementById("imgToBase64").files[0];
      if (!file) return alert("è«‹å…ˆé¸æ“‡åœ–ç‰‡");
      const reader = new FileReader();
      reader.onload = () => {
        document.getElementById("base64Output").value = reader.result;
        log("åœ–ç‰‡å·²è½‰æ›ç‚º Base64");
      };
      reader.readAsDataURL(file);
    });

    // Base64 â åœ–ç‰‡
    document.getElementById("convertToImage").addEventListener("click", () => {
      const file = document.getElementById("base64File").files[0];
      if (!file) return alert("è«‹å…ˆé¸æ“‡ Base64 æª”æ¡ˆ");
      const reader = new FileReader();
      reader.onload = () => {
        let base64 = reader.result.trim();
        if (!base64.startsWith("data:image")) {
          base64 = "data:image/png;base64," + base64;
        }
        document.getElementById("outputImg").src = base64;
        log("Base64 å·²è½‰æ›ç‚ºåœ–ç‰‡");
      };
      reader.readAsText(file);
    });

    // å°ºå¯¸èª¿æ•´
    const resizeOption = document.getElementById("resizeOption");
    const customWidth = document.getElementById("customWidth");
    const customHeight = document.getElementById("customHeight");

    resizeOption.addEventListener("change", () => {
      if (resizeOption.value === "custom") {
        customWidth.style.display = "inline-block";
        customHeight.style.display = "inline-block";
      } else {
        customWidth.style.display = "none";
        customHeight.style.display = "none";
      }
    });

    document.getElementById("startResize").addEventListener("click", () => {
      const files = document.getElementById("resizeFiles").files;
      if (!files.length) return alert("è«‹å…ˆé¸æ“‡åœ–ç‰‡");

      let width, height;
      if (resizeOption.value === "custom") {
        width = parseInt(customWidth.value);
        height = parseInt(customHeight.value);
        if (!width || !height) return alert("è«‹è¼¸å…¥è‡ªè¨‚å¯¬é«˜");
      } else if (resizeOption.value !== "original") {
        width = parseInt(resizeOption.value);
      }

      const progressBar = document.getElementById("progressBar");
      const progressFill = progressBar.firstElementChild;
      progressBar.style.display = "block";
      progressFill.style.width = "0%";

      const zip = new JSZip();
      let processed = 0;

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement("canvas");
            if (width && height) {
              canvas.width = width;
              canvas.height = height;
            } else if (width) {
              canvas.width = width;
              canvas.height = img.height * (width / img.width);
            } else {
              canvas.width = img.width;
              canvas.height = img.height;
            }
            canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);
            canvas.toBlob(blob => {
              zip.file(file.name, blob);
              processed++;
              const percent = Math.round((processed / files.length) * 100);
              progressFill.style.width = percent + "%";
              log(`è™•ç†å®Œæˆï¼š${file.name}`);
              if (processed === files.length) {
                zip.generateAsync({ type: "blob" }).then(content => {
                  const link = document.createElement("a");
                  link.href = URL.createObjectURL(content);
                  link.download = "resized_images.zip";
                  document.getElementById("downloadZip").style.display = "block";
                  document.getElementById("downloadZip").onclick = () => link.click();
                  log("æ‰€æœ‰åœ–ç‰‡å·²å®Œæˆï¼Œé»æ“Šä¸‹è¼‰ ZIP");
                });
              }
            }, "image/png");
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</body>
</html>
